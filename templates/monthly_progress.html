{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h2>Monthly Progress</h2>

    <!-- Task Completion by Priority -->
    <h3>Priority vs Completion %</h3>
    <canvas id="priorityCompletionChart"></canvas>

    <!-- Monthly Progress for Tasks -->
    <h3>Monthly Progress - Tasks</h3>
    <canvas id="taskProgressChart"></canvas>

    <!-- Monthly Progress for Action Items -->
    <h3>Monthly Progress - Action Items</h3>
    <canvas id="actionProgressChart"></canvas>
	
	<!-- Action Item Status Breakdown -->
	<h3>Action Item Status Breakdown</h3>
	<canvas id="actionStatusChart"></canvas>
	
	<!-- Total Task Count by Priority -->
	<h3>Total Tasks by Priority</h3>
	<canvas id="totalTasksByPriorityChart"></canvas>
	
	<!-- Task Completion Timeline -->
	<h3>Task Completion Timeline</h3>
	<canvas id="taskCompletionTimelineChart"></canvas>
	
</div>

<script src="/static/chart.min.js"></script>

<script>
	document.addEventListener("DOMContentLoaded", async () => {
	    try {
	        const response = await fetch("/monthly-progress-data");
	        const data = await response.json();

	        // Priority vs Completion %
	        const ctx1 = document.getElementById("priorityCompletionChart").getContext("2d");
	        new Chart(ctx1, {
	            type: "bar",
	            data: {
	                labels: Object.keys(data.priority_completion),
	                datasets: [{
	                    label: "Completion % by Priority",
	                    data: Object.values(data.priority_completion),
	                    backgroundColor: ["#FF0000", "#FFA500", "#00FFFF", "#808080"] // Colors for High, Medium, Low, Default priorities
	                }]
	            },
	            options: { responsive: true, scales: { y: { beginAtZero: true } } }
	        });

	        // Monthly Task Progress
	        const ctx2 = document.getElementById("taskProgressChart").getContext("2d");
	        new Chart(ctx2, {
	            type: "bar",
	            data: {
	                labels: data.task_progress.labels,
	                datasets: [
	                    { label: "Completed", data: data.task_progress.completed, backgroundColor: "#4BC0C0" },
	                    { label: "In Progress", data: data.task_progress.in_progress, backgroundColor: "#FF9F40" },
	                    { label: "Open", data: data.task_progress.open, backgroundColor: "#FF6384" }
	                ]
	            },
	            options: { responsive: true, scales: { y: { beginAtZero: true } } }
	        });

	        // Monthly Action Item Progress
	        const ctx3 = document.getElementById("actionProgressChart").getContext("2d");
	        new Chart(ctx3, {
	            type: "bar",
	            data: {
	                labels: data.action_progress.labels,
	                datasets: [
	                    { label: "Completed", data: data.action_progress.completed, backgroundColor: "#4BC0C0" },
	                    { label: "In Progress", data: data.action_progress.in_progress, backgroundColor: "#FF9F40" },
	                    { label: "Open", data: data.action_progress.open, backgroundColor: "#FF6384" }
	                ]
	            },
	            options: { responsive: true, scales: { y: { beginAtZero: true } } }
	        });

	        // Action Item Status Breakdown
	        const ctx4 = document.getElementById("actionStatusChart").getContext("2d");
	        new Chart(ctx4, {
	            type: "pie",
	            data: {
	                labels: Object.keys(data.status_breakdown),
	                datasets: [{
	                    label: "Action Item Status",
	                    data: Object.values(data.status_breakdown),
	                    backgroundColor: ["#4BC0C0", "#FF9F40", "#FF6384"]
	                }]
	            },
	            options: { responsive: true }
	        });

	        // Total Tasks by Priority
	        const ctx5 = document.getElementById("totalTasksByPriorityChart").getContext("2d");
	        new Chart(ctx5, {
	            type: "bar",
	            data: {
	                labels: Object.keys(data.total_tasks_by_priority),
	                datasets: [{
	                    label: "Total Tasks by Priority",
	                    data: Object.values(data.total_tasks_by_priority),
	                    backgroundColor: ["#FF0000", "#FFA500", "#00FFFF", "#808080"]
	                }]
	            },
	            options: { responsive: true, scales: { y: { beginAtZero: true } } }
	        });

	        // Task Completion Timeline
	        const ctx6 = document.getElementById("taskCompletionTimelineChart").getContext("2d");
	        new Chart(ctx6, {
	            type: "line",
	            data: {
	                labels: data.task_completion_timeline.dates,
	                datasets: [{
	                    label: "Completed Tasks Over Time",
	                    data: data.task_completion_timeline.completed_tasks,
	                    backgroundColor: "#4BC0C0",
	                    borderColor: "#4BC0C0",
	                    fill: false
	                }]
	            },
	            options: { responsive: true, scales: { y: { beginAtZero: true } } }
	        });
	    } catch (error) {
	        console.error("Error loading chart data:", error);
	    }
	});

</script>
{% endblock %}